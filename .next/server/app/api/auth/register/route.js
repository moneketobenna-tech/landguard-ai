"use strict";(()=>{var e={};e.id=2,e.ids=[2],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},7117:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>T,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>g,serverHooks:()=>m,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>S});var n={};r.r(n),r.d(n,{POST:()=>f,dynamic:()=>d});var a=r(5419),s=r(9108),i=r(9678),u=r(8070),o=r(6521),l=r.n(o),c=r(895),p=r(4405);let d="force-dynamic";async function f(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return u.Z.json({success:!1,error:"Email and password are required"},{status:400});if(r.length<8)return u.Z.json({success:!1,error:"Password must be at least 8 characters"},{status:400});if(await (0,c.CX)(t))return u.Z.json({success:!1,error:"Email already registered"},{status:409});let n=await l().hash(r,12),a=await (0,c.r4)(t,n),s=(0,p.fT)({userId:a.id,email:a.email,planType:a.planType}),i=u.Z.json({success:!0,user:{id:a.id,email:a.email,planType:a.planType,licenseKey:a.licenseKey}});return i.cookies.set("lg_token",s,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),i}catch(e){return console.error("[Register] Error:",e),u.Z.json({success:!1,error:"Registration failed"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"C:\\Users\\Toby\\Desktop\\landguard-ai\\app\\api\\auth\\register\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:y,serverHooks:m,headerHooks:w,staticGenerationBailout:S}=g,T="/api/auth/register/route";function v(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:y})}},4405:(e,t,r)=>{r.d(t,{WX:()=>u,a8:()=>o,fT:()=>i,jc:()=>l});var n=r(6082),a=r.n(n);let s=process.env.JWT_SECRET||"landguard-dev-secret-change-in-production";function i(e){return a().sign(e,s,{expiresIn:"7d"})}async function u(e){try{return a().verify(e,s)}catch{return null}}function o(e){return e?.startsWith("Bearer ")?e.slice(7):null}function l(e){if(!e)return null;let t=e.match(/lg_token=([^;]+)/);return t?t[1]:null}},895:(e,t,r)=>{r.d(t,{CX:()=>c,D0:()=>p,G3:()=>d,GA:()=>l,r4:()=>o});var n=r(4409);let a=new Map,s=new Map,i=null;async function u(){return i||(process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN?i=(0,n.eI)({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN}):null)}async function o(e,t){let r=e.toLowerCase().trim(),n="lg_"+Date.now().toString(36)+Math.random().toString(36).slice(2),i={id:n,email:r,passwordHash:t,planType:"free",licenseKey:function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t=[];for(let r=0;r<4;r++){let r="";for(let t=0;t<4;t++)r+=e[Math.floor(Math.random()*e.length)];t.push(r)}return t.join("-")}(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},o=await u();return o?(await o.set(`user:${n}`,JSON.stringify(i)),await o.set(`email:${r}`,n)):(a.set(n,i),s.set(r,n)),i}async function l(e){let t=await u();if(t){let r=await t.get(`user:${e}`);return r?"string"==typeof r?JSON.parse(r):r:null}return a.get(e)||null}async function c(e){let t=e.toLowerCase().trim(),r=await u();if(r){let e=await r.get(`email:${t}`);return e?l(e):null}let n=s.get(t);return n&&a.get(n)||null}async function p(e,t,r){let n=await l(e);if(!n)return null;n.planType=t,r&&(n.stripeCustomerId=r),n.updatedAt=new Date().toISOString();let s=await u();return s?await s.set(`user:${e}`,JSON.stringify(n)):a.set(e,n),n}function d(e){if(!e)return"";let t=e.split("-");return 4!==t.length?"****-****-****-****":`${t[0]}-****-****-${t[3]}`}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,409,82,521],()=>r(7117));module.exports=n})();