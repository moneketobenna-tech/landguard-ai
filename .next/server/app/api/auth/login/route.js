"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},6976:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>T,patchFetch:()=>v,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y,staticGenerationBailout:()=>S});var n={};r.r(n),r.d(n,{POST:()=>f,dynamic:()=>d});var a=r(5419),i=r(9108),s=r(9678),o=r(8070),u=r(6521),l=r.n(u),c=r(895),p=r(4405);let d="force-dynamic";async function f(e){try{let{email:t,password:r}=await e.json();if(!t||!r)return o.Z.json({success:!1,error:"Email and password are required"},{status:400});let n=await (0,c.CX)(t);if(!n||!await l().compare(r,n.passwordHash))return o.Z.json({success:!1,error:"Invalid email or password"},{status:401});let a=(0,p.fT)({userId:n.id,email:n.email,planType:n.planType}),i=o.Z.json({success:!0,user:{id:n.id,email:n.email,planType:n.planType,licenseKey:n.licenseKey}});return i.cookies.set("lg_token",a,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:604800}),i}catch(e){return console.error("[Login] Error:",e),o.Z.json({success:!1,error:"Login failed"},{status:500})}}let g=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\Toby\\Desktop\\landguard-ai\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:h,headerHooks:w,staticGenerationBailout:S}=g,T="/api/auth/login/route";function v(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},4405:(e,t,r)=>{r.d(t,{WX:()=>o,a8:()=>u,fT:()=>s,jc:()=>l});var n=r(6082),a=r.n(n);let i=process.env.JWT_SECRET||"landguard-dev-secret-change-in-production";function s(e){return a().sign(e,i,{expiresIn:"7d"})}async function o(e){try{return a().verify(e,i)}catch{return null}}function u(e){return e?.startsWith("Bearer ")?e.slice(7):null}function l(e){if(!e)return null;let t=e.match(/lg_token=([^;]+)/);return t?t[1]:null}},895:(e,t,r)=>{r.d(t,{CX:()=>c,D0:()=>p,G3:()=>d,GA:()=>l,r4:()=>u});var n=r(4409);let a=new Map,i=new Map,s=null;async function o(){return s||(process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN?s=(0,n.eI)({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN}):null)}async function u(e,t){let r=e.toLowerCase().trim(),n="lg_"+Date.now().toString(36)+Math.random().toString(36).slice(2),s={id:n,email:r,passwordHash:t,planType:"free",licenseKey:function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t=[];for(let r=0;r<4;r++){let r="";for(let t=0;t<4;t++)r+=e[Math.floor(Math.random()*e.length)];t.push(r)}return t.join("-")}(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},u=await o();return u?(await u.set(`user:${n}`,JSON.stringify(s)),await u.set(`email:${r}`,n)):(a.set(n,s),i.set(r,n)),s}async function l(e){let t=await o();if(t){let r=await t.get(`user:${e}`);return r?"string"==typeof r?JSON.parse(r):r:null}return a.get(e)||null}async function c(e){let t=e.toLowerCase().trim(),r=await o();if(r){let e=await r.get(`email:${t}`);return e?l(e):null}let n=i.get(t);return n&&a.get(n)||null}async function p(e,t,r){let n=await l(e);if(!n)return null;n.planType=t,r&&(n.stripeCustomerId=r),n.updatedAt=new Date().toISOString();let i=await o();return i?await i.set(`user:${e}`,JSON.stringify(n)):a.set(e,n),n}function d(e){if(!e)return"";let t=e.split("-");return 4!==t.length?"****-****-****-****":`${t[0]}-****-****-${t[3]}`}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,409,82,521],()=>r(6976));module.exports=n})();