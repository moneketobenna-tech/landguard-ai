"use strict";(()=>{var e={};e.id=788,e.ids=[788],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},2571:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>y,originalPathname:()=>S,patchFetch:()=>_,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var n={};r.r(n),r.d(n,{DELETE:()=>d,GET:()=>p,dynamic:()=>c});var a=r(5419),s=r(9108),o=r(9678),u=r(8070),i=r(4405),l=r(895);let c="force-dynamic";async function p(e){try{let t=e.headers.get("authorization"),r=e.headers.get("cookie"),n=(0,i.a8)(t)||(0,i.jc)(r);if(!n)return u.Z.json({success:!1,error:"Not authenticated"},{status:401});let a=await (0,i.WX)(n);if(!a){let e=u.Z.json({success:!1,error:"Invalid token"},{status:401});return e.cookies.delete("lg_token"),e}let s=await (0,l.GA)(a.userId);if(!s){let e=u.Z.json({success:!1,error:"User not found"},{status:404});return e.cookies.delete("lg_token"),e}return u.Z.json({success:!0,user:{id:s.id,email:s.email,planType:s.planType,licenseKey:(0,l.G3)(s.licenseKey),createdAt:s.createdAt}})}catch(e){return console.error("[Me] Error:",e),u.Z.json({success:!1,error:"Failed to get user"},{status:500})}}async function d(e){let t=u.Z.json({success:!0,message:"Logged out"});return t.cookies.delete("lg_token"),t}let f=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/me/route",pathname:"/api/auth/me",filename:"route",bundlePath:"app/api/auth/me/route"},resolvedPagePath:"C:\\Users\\Toby\\Desktop\\landguard-ai\\app\\api\\auth\\me\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:y,staticGenerationBailout:w}=f,S="/api/auth/me/route";function _(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},4405:(e,t,r)=>{r.d(t,{WX:()=>u,a8:()=>i,fT:()=>o,jc:()=>l});var n=r(6082),a=r.n(n);let s=process.env.JWT_SECRET||"landguard-dev-secret-change-in-production";function o(e){return a().sign(e,s,{expiresIn:"7d"})}async function u(e){try{return a().verify(e,s)}catch{return null}}function i(e){return e?.startsWith("Bearer ")?e.slice(7):null}function l(e){if(!e)return null;let t=e.match(/lg_token=([^;]+)/);return t?t[1]:null}},895:(e,t,r)=>{r.d(t,{CX:()=>c,D0:()=>p,G3:()=>d,GA:()=>l,r4:()=>i});var n=r(4409);let a=new Map,s=new Map,o=null;async function u(){return o||(process.env.KV_REST_API_URL&&process.env.KV_REST_API_TOKEN?o=(0,n.eI)({url:process.env.KV_REST_API_URL,token:process.env.KV_REST_API_TOKEN}):null)}async function i(e,t){let r=e.toLowerCase().trim(),n="lg_"+Date.now().toString(36)+Math.random().toString(36).slice(2),o={id:n,email:r,passwordHash:t,planType:"free",licenseKey:function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t=[];for(let r=0;r<4;r++){let r="";for(let t=0;t<4;t++)r+=e[Math.floor(Math.random()*e.length)];t.push(r)}return t.join("-")}(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},i=await u();return i?(await i.set(`user:${n}`,JSON.stringify(o)),await i.set(`email:${r}`,n)):(a.set(n,o),s.set(r,n)),o}async function l(e){let t=await u();if(t){let r=await t.get(`user:${e}`);return r?"string"==typeof r?JSON.parse(r):r:null}return a.get(e)||null}async function c(e){let t=e.toLowerCase().trim(),r=await u();if(r){let e=await r.get(`email:${t}`);return e?l(e):null}let n=s.get(t);return n&&a.get(n)||null}async function p(e,t,r){let n=await l(e);if(!n)return null;n.planType=t,r&&(n.stripeCustomerId=r),n.updatedAt=new Date().toISOString();let s=await u();return s?await s.set(`user:${e}`,JSON.stringify(n)):a.set(e,n),n}function d(e){if(!e)return"";let t=e.split("-");return 4!==t.length?"****-****-****-****":`${t[0]}-****-****-${t[3]}`}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,206,409,82],()=>r(2571));module.exports=n})();